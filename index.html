<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>¡Las Estaciones del Año!</title>
</head>
<body class="bg-gradient-to-r from-blue-200 to-green-200 min-h-screen flex items-center justify-center p-4">

  <div class="w-full max-w-2xl">
    <!-- Bienvenida -->
    <div id="welcomeCard" class="bg-white rounded-2xl shadow-lg p-6 space-y-4">
      <h1 class="text-2xl font-bold text-center text-blue-700">🌎 ¡Bienvenido al Quiz de las Estaciones!</h1>
      <p class="text-gray-600 text-center">Ingresa tus datos para comenzar.</p>
      <input id="studentName" type="text" placeholder="Tu nombre" class="w-full border rounded p-2">
      <input id="studentCourse" type="text" placeholder="Tu curso" class="w-full border rounded p-2">
      <button id="startQuiz" class="w-full bg-blue-600 text-white rounded p-2 hover:bg-blue-700">Comenzar</button>
    </div>

    <!-- Material de estudio -->
    <div id="studyCard" class="hidden bg-white rounded-2xl shadow-lg p-6 space-y-4">
      <h2 class="text-xl font-bold text-center text-green-700">📚 Material de Estudio: Las Estaciones del Año</h2>
      <p class="text-gray-700">
        - <strong>Primavera:</strong> Florecen las plantas, hay temperaturas templadas y lluvias frecuentes.<br>
        - <strong>Verano:</strong> Días largos y calurosos, usamos ropa ligera y disfrutamos del sol.<br>
        - <strong>Otoño:</strong> Caen las hojas de los árboles y el clima se enfría.<br>
        - <strong>Invierno:</strong> Temperaturas frías, nieve en algunos lugares y celebramos la Navidad.
      </p>
      <button id="goToQuiz" class="w-full bg-green-600 text-white rounded p-2 hover:bg-green-700">Ir al examen</button>
    </div>

    <!-- Preguntas -->
    <div id="quizCard" class="hidden bg-white rounded-2xl shadow-lg p-6 space-y-4">
      <h2 id="questionTitle" class="text-lg font-semibold text-gray-800"></h2>
      <div id="options" class="space-y-2"></div>
      <div class="flex justify-between">
        <button id="prevBtn" class="bg-gray-400 text-white rounded p-2">Anterior</button>
        <button id="nextBtn" class="bg-gray-600 text-white rounded p-2">Siguiente</button>
      </div>
      <button id="submitQuiz" class="hidden w-full bg-green-600 text-white rounded p-2 hover:bg-green-700">Enviar respuestas</button>
    </div>

    <!-- Resultados -->
    <div id="resultCard" class="hidden bg-white rounded-2xl shadow-lg p-6 space-y-4 text-center">
      <h2 class="text-xl font-bold text-gray-800">📊 Resultados</h2>
      <p id="finalScore" class="text-lg"></p>
      <p id="finalMessage" class="text-gray-700"></p>
      <p id="sendStatus" class="text-sm text-gray-500"></p>
      <button id="newExam" class="mt-4 w-full bg-blue-600 text-white rounded p-2 hover:bg-blue-700">Nuevo examen</button>
    </div>
  </div>

  <script>
    // 👉 Pega aquí tu URL de Apps Script desplegado (versión web)
    const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycby1KrW-k14q9SQn-QZYdd-V3U4OQ_pUqw7ZwTgCRAUm8umjBniNltTEm9S2Psb5lHE/exec";

    const QUESTIONS = [
      { q:"¿Cuál estación sigue después de la primavera?", options:["Verano","Invierno","Otoño"], answer:0 },
      { q:"¿En qué estación caen las hojas de los árboles?", options:["Invierno","Otoño","Verano"], answer:1 },
      { q:"¿En qué estación hace más frío?", options:["Invierno","Primavera","Verano"], answer:0 },
      { q:"¿En qué estación florecen las plantas?", options:["Primavera","Otoño","Verano"], answer:0 },
      { q:"¿En qué estación se celebran las navidades?", options:["Primavera","Invierno","Verano"], answer:1 },
      { q:"¿En qué estación usamos ropa ligera por el calor?", options:["Otoño","Primavera","Verano"], answer:2 },
      { q:"¿Cuál estación se caracteriza por lluvias y flores?", options:["Primavera","Invierno","Otoño"], answer:0 },
      { q:"¿Cuál estación es antes del invierno?", options:["Otoño","Verano","Primavera"], answer:0 },
      { q:"¿En qué estación jugamos con nieve?", options:["Invierno","Primavera","Verano"], answer:0 },
      { q:"¿Qué estación tiene días más largos y soleados?", options:["Verano","Invierno","Otoño"], answer:0 }
    ];

    let currentQ = 0;
    let answers = Array(QUESTIONS.length).fill(null);
    let student = {name:"", course:""};

    const welcomeCard=document.getElementById("welcomeCard");
    const studyCard=document.getElementById("studyCard");
    const quizCard=document.getElementById("quizCard");
    const resultCard=document.getElementById("resultCard");
    const questionTitle=document.getElementById("questionTitle");
    const optionsDiv=document.getElementById("options");
    const prevBtn=document.getElementById("prevBtn");
    const nextBtn=document.getElementById("nextBtn");
    const submitQuiz=document.getElementById("submitQuiz");
    const finalScore=document.getElementById("finalScore");
    const finalMessage=document.getElementById("finalMessage");
    const sendStatus=document.getElementById("sendStatus");

    // Paso 1: Bienvenida -> Material
    document.getElementById("startQuiz").addEventListener("click", ()=>{
      const name=document.getElementById("studentName").value.trim();
      const course=document.getElementById("studentCourse").value.trim();
      if(!name || !course){ alert("Por favor ingresa tu nombre y curso"); return; }
      student.name=name; student.course=course;
      welcomeCard.classList.add("hidden");
      studyCard.classList.remove("hidden");
    });

    // Paso 2: Material -> Examen
    document.getElementById("goToQuiz").addEventListener("click", ()=>{
      studyCard.classList.add("hidden");
      quizCard.classList.remove("hidden");
      showQuestion();
    });

    function showQuestion(){
      const q=QUESTIONS[currentQ];
      questionTitle.textContent = (currentQ+1)+". "+q.q;
      optionsDiv.innerHTML="";
      q.options.forEach((opt,idx)=>{
        const btn=document.createElement("button");
        btn.textContent=opt;
        btn.className="w-full border rounded p-2 text-left hover:bg-blue-100";
        if(answers[currentQ]===idx){ btn.classList.add("bg-blue-200"); }
        btn.onclick=()=>{ answers[currentQ]=idx; showQuestion(); };
        optionsDiv.appendChild(btn);
      });
      prevBtn.disabled=(currentQ===0);
      nextBtn.style.display=(currentQ===QUESTIONS.length-1)?"none":"block";
      submitQuiz.classList.toggle("hidden", currentQ!==QUESTIONS.length-1);
    }

    prevBtn.addEventListener("click", ()=>{ if(currentQ>0){ currentQ--; showQuestion(); } });
    nextBtn.addEventListener("click", ()=>{ if(currentQ<QUESTIONS.length-1){ currentQ++; showQuestion(); } });

    function computeScore(){
      return answers.reduce((acc,a,idx)=> a===QUESTIONS[idx].answer?acc+1:acc,0);
    }

    submitQuiz.addEventListener("click", async ()=>{
      const score=computeScore();
      quizCard.classList.add("hidden");
      resultCard.classList.remove("hidden");
      finalScore.textContent=`Tu nota: ${score} / ${QUESTIONS.length}`;
      finalMessage.textContent = score>=7? "¡Excelente!" : (score>=4? "Buen intento" : "Sigue practicando");
      sendStatus.textContent="Guardando registro...";
    
      const formData=new FormData();
      formData.append("name", student.name);
      formData.append("course", student.course);
      formData.append("score", score);
      formData.append("total", QUESTIONS.length);
      formData.append("answers", JSON.stringify(answers));
    
      try{
        const resp=await fetch(APPS_SCRIPT_URL, {method:"POST", body:formData});
        if(resp.ok){
          sendStatus.textContent="Registro guardado correctamente ✅";
        } else {
          sendStatus.textContent="Error al guardar en el servidor ❌";
        }
      }catch(err){
        sendStatus.innerHTML="No se pudo enviar. Revisa el Apps Script.";
        console.error(err);
      }
    });

    // Botón para reiniciar
    document.getElementById("newExam").addEventListener("click", ()=>{
      window.location.reload();
    });
  </script>
</body>
</html>
